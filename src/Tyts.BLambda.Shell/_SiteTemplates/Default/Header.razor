@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using Microsoft.Extensions.Options;

<header class="flex nowrap center" role="banner">
    <Logo/>
    <FlexBox Class="box"
             Orientation="Orientation.Vertical" HorizontalGap="0" VerticalGap="0"
             HorizontalAlignment="FlexBoxHorizontalAlignment.Right"
             VerticalAlignment="FlexBoxVerticalAlignment.Center"
             >
        
        <AuthorizeView>
            <Authorized>

                <div class="toolbar">
                    <FluentButton Appearance="Appearance.Stealth" @onclick="SignOut" title="Sign out">
                        <FluentIcon Value="@(new Icons.Regular.Size20.SignOut())" />
                    </FluentButton>
                </div>               
               
                <MenuButton Id="accont-button" Text="@(context.User.Identity?.Name)" Width="175px">  
                                        
                        <FluentMenuItem OnClick="@((e) => {  Navigation.NavigateTo("/account/info"); })" Checked="true">
                            Account Info
                        </FluentMenuItem>
                        <FluentMenuItem>
                            <button onclick="@(() => logger.LogInformation("QQQ"))">Qqq</button>
                        </FluentMenuItem>
                        <FluentMenuItem OnClick="OnClickHandlerAsync">
                            Kkk
                        </FluentMenuItem>
                        <FluentDivider />


                        @if (this.IsDebug())
                        {
                            <FluentMenuItem OnClick="@((e) => Navigation.NavigateTo("/authentication/identity"))">
                                Identity
                            </FluentMenuItem>
                            <FluentDivider />
                        }


                        <FluentMenuItem OnClick="SignOut">
                            Sign out
                        </FluentMenuItem>
                        
                   
                </MenuButton>


            </Authorized>
            <NotAuthorized>
                <h1>BLambda Shell</h1>
                <a href="authentication/login">Log in</a>
            </NotAuthorized>
        </AuthorizeView>

    </FlexBox>
</header>

@inject NavigationManager Navigation
@inject IOptionsSnapshot<RemoteAuthenticationOptions<ApiAuthorizationProviderOptions>> Options
@inject ILogger<Header> logger;

@code {
    
    protected async Task OnClickHandlerAsync()
    {
        logger.LogInformation("QQQ");
    }

    void SignOut()
    {       
        var logoutPath = Options.Get(Microsoft.Extensions.Options.Options.DefaultName).AuthenticationPaths.LogOutPath;

        ////! it seems do not clear localStorage
        //Navigation.NavigateTo(logoutPath, replace: true);
        Navigation.NavigateToLogout(logoutPath);
    }
}
